# SME 會計進銷存系統 - 解析文檔

> 📌 **系統說明**：這是一個單機版的會計進銷存系統，使用純 HTML 檔案，資料儲存在瀏覽器的 LocalStorage 中。

---

## 一、系統架構總覽

### 🎯 核心特色
- **完全離線運作**：開啟 HTML 檔案即可使用，無需安裝或網路連線
- **資料本地存儲**：使用瀏覽器 LocalStorage，鍵名為 `sme-app-v1`
- **複式記帳**：每筆交易自動產生平衡的會計傳票
- **平均成本法**：庫存成本採用移動加權平均計算
- **即時報表**：損益表、資產負債表、試算表隨時可查

### 📊 八大功能模組

| 模組 | 功能說明 |
|------|---------|
| **總覽** | 顯示本月銷售額、庫存價值、毛利率等關鍵指標 |
| **商品/存貨** | 管理商品資料、查看庫存數量與平均成本 |
| **銷售（開立發票）** | 建立銷售單、自動減少庫存、結轉銷貨成本 |
| **進貨（採購）** | 建立採購單、自動更新平均成本、增加庫存 |
| **客戶/供應商** | 維護客戶與供應商名單 |
| **傳票 & 科目** | 查看所有會計分錄與科目餘額 |
| **報表** | 試算表、損益表、資產負債表、庫存估價 |
| **設定** | 設置公司名稱、幣別符號、營業稅率 |

---

## 二、數據結構說明

### 💼 系統設定（settings）
記錄公司的基本設定資訊：

- **公司名稱**（orgName）：預設為「範例公司」
- **幣別符號**（currency）：預設為「NT$」
- **營業稅率**（taxRate）：預設為 0.05（5%）

### 📚 會計科目（accounts）
系統預設了 8 個基本科目：

| 代碼 | 名稱 | 類型 | 說明 |
|------|------|------|------|
| 1001 | 現金/銀行 | 資產 | 現金與銀行存款 |
| 1100 | 應收帳款 | 資產 | 賒銷給客戶的款項 |
| 1400 | 存貨 | 資產 | 商品庫存價值 |
| 2100 | 應付帳款 | 負債 | 欠供應商的款項 |
| 2300 | 營業稅應付 | 負債 | 銷項稅額 - 進項稅額 |
| 3000 | 業主權益 | 權益 | 老闆投入的資本 |
| 4000 | 銷貨收入 | 收入 | 銷售商品的收入 |
| 5000 | 銷貨成本 | 費用 | 銷售商品的成本 |

**科目餘額計算規則**：
- 資產、費用類：餘額 = 借方 - 貸方
- 負債、權益、收入類：餘額 = 貸方 - 借方

### 🏷️ 商品存貨（items）
每個商品包含以下資訊：

- **唯一識別碼**（id）：自動生成的 7 位隨機碼
- **料號**（sku）：例如 A100、B200
- **商品名稱**（name）
- **庫存數量**（qty）：隨採購增加、銷售減少
- **平均成本**（avgCost）：**重點**！採購時自動更新
- **商品類別**（category）：用於分類

### 👥 客戶與供應商（partners）
分為兩個清單：
- **customers**：客戶名單（用於銷售單）
- **vendors**：供應商名單（用於採購單）

### 📝 交易記錄（txns）
記錄每筆銷售或採購，包含：

- **交易類型**（type）：`sale` 銷售 或 `purchase` 採購
- **日期**（date）：YYYY-MM-DD 格式
- **單號**（docNo）：自動生成，格式如 `S241017-001`
- **對象 ID**（partnerId）：客戶或供應商的 ID
- **付款方式**（pm）：`cash` 現金 或 `credit` 賒帳
- **明細行**（lines）：商品清單，每行包含商品 ID、數量、單價
- **備註**（note）：選填

### 🧾 會計傳票（journals）
系統自動生成的會計分錄：

- **傳票編號**（id）
- **日期**（date）
- **單號**（docNo）：對應交易單號
- **摘要**（desc）：例如「銷售 S241017-001」
- **分錄明細**（lines）：包含科目代碼、借方金額、貸方金額

---

## 三、核心業務邏輯

### 📦 庫存管理：平均成本法

#### 為什麼使用平均成本法？
1. **計算簡單**：不需追蹤每批進貨的成本
2. **適合中小企業**：避免 FIFO（先進先出）、LIFO（後進先出）的複雜度
3. **會計常用**：台灣中小企業普遍採用

#### 採購時更新平均成本

每次進貨時，系統會重新計算平均成本：

**計算公式**：
```
新平均成本 = (原有庫存價值 + 本次進貨價值) ÷ (原有數量 + 進貨數量)
```

**範例**：
- 原有：10 個，平均成本 100 元 → 總價值 1,000 元
- 進貨：5 個，單價 120 元 → 總價值 600 元
- 新平均成本 = (1,000 + 600) ÷ (10 + 5) = **106.67 元**

#### 銷售時減少庫存

銷售時的處理方式：
- ✅ 減少庫存數量
- ✅ 使用當前平均成本計算銷貨成本
- ❌ **不改變**平均成本（平均成本只在採購時更新）

**庫存不足檢查**：
- 輸入時即時顯示警告（紅色標示）
- 提交時若庫存不足會阻止交易

---

### 💰 會計傳票自動生成

系統採用**複式記帳**，每筆交易都會產生平衡的分錄（借方總額 = 貸方總額）。

#### 採購傳票規則

**現金採購範例**：
```
採購商品 10 個，單價 100 元，稅率 5%
```

| 分錄 | 科目 | 借方 | 貸方 |
|------|------|------|------|
| 1 | 1400 存貨 | 1,000 | - |
| 2 | 2300 營業稅（進項） | 50 | - |
| 3 | 1001 現金 | - | 1,050 |

**賒帳採購範例**：
- 第 3 行改為：2100 應付帳款（貸方 1,050）

**業務影響**：
- ✅ 更新商品平均成本
- ✅ 增加庫存數量
- ✅ 減少現金（或增加應付帳款）
- ✅ 記錄進項稅額

---

#### 銷售傳票規則

**現金銷售範例**：
```
銷售商品 5 個，售價 150 元，平均成本 100 元，稅率 5%
```

| 分錄 | 科目 | 借方 | 貸方 | 說明 |
|------|------|------|------|------|
| 1 | 1001 現金 | 787.5 | - | 收到含稅金額 |
| 2 | 4000 銷貨收入 | - | 750 | 未稅銷售額 |
| 3 | 2300 營業稅（銷項） | - | 37.5 | 代收營業稅 |
| 4 | 5000 銷貨成本 | 500 | - | 成本結轉 |
| 5 | 1400 存貨 | - | 500 | 減少庫存 |

**賒帳銷售範例**：
- 第 1 行改為：1100 應收帳款（借方 787.5）

**業務影響**：
- ✅ 減少庫存數量（但不改平均成本）
- ✅ 增加現金（或應收帳款）
- ✅ 記錄銷售收入
- ✅ 記錄銷項稅額
- ✅ 自動結轉銷貨成本

---

### 📈 報表系統

#### 總帳餘額（ledgerBalances）
系統會遍歷所有傳票，累加每個科目的借方與貸方金額，然後計算餘額。

#### 試算表（Trial Balance）
將所有科目分為兩類：
- **借方類**（資產 + 費用）：餘額總和
- **貸方類**（負債 + 權益 + 收入）：餘額總和

**檢驗原則**：在記帳正確的情況下，借方類總和 = 貸方類總和

#### 損益表（Profit & Loss）
計算公式：
```
營業收入（4000）
- 銷貨成本（5000）
= 本期損益
```

- 盈餘為正數（收入 > 成本）
- 虧損為負數（收入 < 成本）

#### 資產負債表（Balance Sheet）
遵循會計等式：
```
資產 = 負債 + 權益
```

**重點**：本期損益視為權益的一部分
- 若有盈餘 → 增加權益
- 若有虧損 → 減少權益

---

## 四、單號命名規則

### 自動生成格式

**銷售單號**：
```
S + 年(2位) + 月(2位) + 日(2位) + - + 流水號(3位)
範例：S241017-001
```

**採購單號**：
```
P + 年(2位) + 月(2位) + 日(2位) + - + 流水號(3位)
範例：P241017-001
```

### 流水號說明
- 基於目前交易總數 + 1
- 使用 3 位數格式（001、002、...、999）
- ⚠️ 注意：若刪除交易會造成號碼重複（目前設計限制）

---

## 五、關鍵功能細節

### 🎨 視覺設計
- **深色主題**：使用深藍灰色背景與漸層效果
- **品牌 Logo**：CSS 徑向漸層製作的雙色球體
- **響應式設計**：900px 為斷點，小螢幕單欄、大螢幕多欄
- **按鈕樣式**：使用漸層背景區分功能（主要/成功/警告/危險）

### 💡 交易表單設計

#### 預設單價邏輯
- **銷售時**：自動填入平均成本 × 1.3（加價 30%）
- **採購時**：自動填入當前平均成本

#### 即時計算功能
當使用者輸入數量或單價時：
1. 立即計算該行小計
2. 匯總所有行的未稅小計
3. 計算營業稅（小計 × 稅率）
4. 計算含稅總額

#### 庫存即時檢查（僅銷售）
- 若輸入數量 > 庫存：小計欄位變紅色
- 滑鼠懸停顯示：「庫存不足 (現有 X)」
- 提交時若庫存不足會拋出錯誤

### 📊 儀表板 KPI

系統會計算本月（當月 1 日～月底）的關鍵指標：

| 指標 | 計算方式 |
|------|----------|
| **本月銷售額** | 本月所有銷售單的含稅總額 |
| **庫存總價值** | 所有商品的 數量 × 平均成本 |
| **毛利率（估）** | (銷售額 - 銷貨成本) ÷ 銷售額 × 100% |

### 🔄 資料管理功能

#### 匯出 JSON
- 點擊「匯出 JSON」按鈕
- 下載檔案名稱：`sme-data-YYYY-MM-DD.json`
- 包含所有系統資料（設定、商品、交易、傳票）

#### 匯入 JSON
- 點擊「匯入」按鈕選擇檔案
- 系統會驗證 JSON 格式
- 成功後覆蓋現有資料並重新整理畫面

#### 重設資料
- 點擊「重設資料」按鈕
- 系統會二次確認
- 確認後恢復為預設範例資料

---

## 六、營業稅處理邏輯

### 為何營業稅單獨設科目？

營業稅的性質是**代收代付**：
- 公司只是「代理人」，幫政府收稅
- 不屬於公司的收入或支出
- 最終需繳納給稅務機關

### 科目 2300 設計

**借方**記錄：進項稅額（採購時付出的稅）  
**貸方**記錄：銷項稅額（銷售時代收的稅）  
**餘額**計算：銷項 - 進項 = **應繳稅額**

**範例**：
- 本月採購支付稅額 5,000（借方）
- 本月銷售代收稅額 8,000（貸方）
- 科目 2300 餘額 = 8,000 - 5,000 = **3,000（應繳）**

---

## 七、系統限制與建議

### ⚠️ 功能限制

| 限制項目 | 說明 |
|---------|------|
| **單機使用** | 資料綁定單一瀏覽器，無法多人協作 |
| **無退貨功能** | 需手動調整庫存或建立反向交易 |
| **無分錄編輯** | 已登錄的傳票無法修改（需匯出 JSON 手動改） |
| **無權限管理** | 無登入系統，任何人都可操作 |
| **單一稅率** | 所有商品統一稅率，無法個別設定 |

### 📏 數據規模建議

為確保順暢運行，建議：
- 商品數量：< 1,000 筆
- 交易記錄：< 5,000 筆
- 傳票數量：< 5,000 筆

**原因**：
- LocalStorage 容量限制（5-10MB）
- 每次渲染都重新計算報表
- 大量資料會造成延遲

### 💾 資料安全建議

1. **定期備份**：每週匯出 JSON 檔案備份
2. **重要操作前備份**：修改大量資料前先匯出
3. **多地備份**：備份檔案存放於雲端硬碟或外接硬碟
4. **換電腦前匯出**：LocalStorage 無法跨裝置

---

## 八、常見問題

### Q1：資料存在哪裡？
**A**：瀏覽器的 LocalStorage，鍵名為 `sme-app-v1`。資料綁定特定瀏覽器與網域。

### Q2：換電腦或瀏覽器後資料會消失嗎？
**A**：會。LocalStorage 是本地儲存，建議定期匯出 JSON 備份。

### Q3：可以多人同時使用嗎？
**A**：不行。這是單機版，每個瀏覽器的資料獨立。

### Q4：如何修改已登錄的交易？
**A**：目前無編輯功能。建議：
1. 匯出 JSON 檔案
2. 用文字編輯器修改
3. 重新匯入

### Q5：試算表不平衡怎麼辦？
**A**：理論上不會發生（程式保證借貸平衡）。若發生可能是：
- 手動修改過 JSON 檔案
- 建議重新匯入備份

### Q6：營業稅率可以改嗎？
**A**：可以在設定頁面修改，但**不影響已登錄的交易**（只對新交易生效）。

### Q7：如何處理退貨？
**A**：建議方式：
1. 在商品管理中手動增加庫存
2. 或建立負數交易（進階做法）

### Q8：清空所有資料怎麼做？
**A**：點擊「重設資料」按鈕，確認後恢復預設範例資料。

---

## 九、適用對象與場景

### ✅ 適合使用

| 對象 | 使用情境 |
|------|---------|
| **個人工作室** | 接案收入與成本管理 |
| **小型商店** | 進銷存與簡易會計 |
| **會計教學** | 示範複式記帳與報表原理 |
| **原型驗證** | 快速驗證商業模式 |
| **離線環境** | 無網路但需記帳的場所 |

### ❌ 不適合使用

| 情況 | 原因 |
|------|------|
| **大型企業** | 需要 ERP 等級的功能 |
| **多人協作** | 無權限管理與同步機制 |
| **稽核追蹤** | 無操作日誌與版本控制 |
| **複雜會計** | 不支援多幣別、專案會計、分公司等 |

---

## 十、核心價值與學習重點

### 🎯 系統核心價值

> **這不是生產級系統，而是一個完整的教學示範**  
> 展示如何用最少的技術實現一個可運行的會計進銷存系統

### 📚 可學習到的知識

1. **會計原理**
   - 複式記帳的借貸平衡
   - 科目分類與餘額計算
   - 財務報表的關聯性

2. **庫存管理**
   - 平均成本法的實際應用
   - 永續盤存制（即時結轉成本）
   - 庫存價值計算

3. **前端技術**
   - 單頁應用（SPA）的實作
   - LocalStorage 資料管理
   - 無框架的純 JavaScript 開發

4. **業務邏輯**
   - 交易流程設計
   - 數據驗證與錯誤處理
   - 即時計算與反饋

---

## 十一、擴展可能性

如果要升級為更完整的系統，可考慮以下方向：

### 🚀 功能擴展

- **多倉庫管理**：支援多個倉庫地點
- **批次號追蹤**：記錄商品批次與有效期
- **應收應付管理**：帳齡分析、收付款記錄
- **多幣別支援**：外幣交易與匯率換算
- **多稅率設定**：不同商品使用不同稅率
- **退貨功能**：完整的退貨流程與分錄

### 🔧 技術升級

- **雲端同步**：使用 Firebase 或 Supabase
- **權限管理**：多使用者與角色權限
- **操作日誌**：記錄所有修改歷程
- **資料加密**：保護敏感資料
- **匯出格式**：支援 PDF、Excel
- **列印功能**：發票、報表列印

---

## 十二、總結

### 系統特色

✅ **零依賴**：純 HTML/CSS/JS，無需安裝任何套件  
✅ **離線可用**：開啟檔案即可使用  
✅ **完整功能**：涵蓋進銷存 + 會計核心功能  
✅ **會計正確**：複式記帳、平均成本法、報表平衡  
✅ **即時反應**：資料變動立即反映於報表  
✅ **易於備份**：一鍵匯出 JSON 完整資料  

### 設計理念

這個系統展示了「**化繁為簡**」的設計哲學：
- 用最少的技術實現核心功能
- 避免過度設計與複雜依賴
- 讓中小企業能快速上手
- 提供教學與原型驗證價值

---

## 附錄：完整交易範例

### 情境：採購與銷售流程

**Day 1 - 採購**
- 商品：A100（初始庫存 0）
- 採購 10 個，單價 100 元
- 稅率 5%，現金交易

**結果**：
- 商品 A100 庫存：10 個
- 平均成本：100 元
- 傳票分錄：借 1400（1,000）、借 2300（50）、貸 1001（1,050）

---

**Day 2 - 銷售**
- 商品：A100
- 銷售 5 個，售價 150 元
- 稅率 5%，現金交易

**結果**：
- 商品 A100 庫存：5 個（10 - 5）
- 平均成本：100 元（不變）
- 傳票分錄：
  - 借 1001（787.5）、貸 4000（750）、貸 2300（37.5）
  - 借 5000（500）、貸 1400（500）

---

**Day 3 - 再次採購**
- 商品：A100
- 採購 10 個，單價 120 元
- 稅率 5%，現金交易

**結果**：
- 商品 A100 庫存：15 個（5 + 10）
- 平均成本：**110 元**（計算：(5×100 + 10×120) ÷ 15 = 110）
- 傳票分錄：借 1400（1,200）、借 2300（60）、貸 1001（1,260）

---

**最終報表**：

**損益表**：
- 銷貨收入：750
- 銷貨成本：500
- 本期損益：**250（盈餘）**

**資產負債表**：
- 現金：-1,522.5（出 2,310，入 787.5）
- 存貨：1,700（5×100 + 10×120 - 5×100）
- 營業稅應付：72.5（進 110，銷 37.5）

---

## 文件資訊

- **文件版本**：2.0（精簡版）
- **對應系統版本**：sme-app-v1
- **最後更新**：2024-10-17
- **文件性質**：系統說明書 / 使用手冊
